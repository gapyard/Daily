<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      display: grid;
      gap: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    label { font-weight: bold; }
    input, textarea, select, button {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #1e293b;
      color: #e2e8f0;
      box-sizing: border-box;
    }
    textarea { min-height: 70px; resize: vertical; }
    .card {
      background: #1e293b;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .photos { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .photos img {
      width: 80px; height: 80px; object-fit: cover;
      border-radius: 10px; border: 1px solid #475569;
    }
    .actions { display: flex; gap: 10px; margin-top: 10px; }
    button { cursor: pointer; border: none; }
    button.danger { background: #dc2626; color: white; }
    button.primary { background: #2563eb; color: white; }
    .muted { color: #94a3b8; font-size: 0.9em; }
    .badge {
      background: #334155; color: #e2e8f0;
      padding: 2px 6px; border-radius: 6px; font-size: 0.8em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìñ ‡πÑ‡∏î‡∏≠‡∏≤‡∏£‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h1>

    <div class="card">
      <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
      <input type="date" id="date">

      <label style="margin-top:10px">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô</label>
      <input type="text" id="place" placeholder="‡πÄ‡∏ä‡πà‡∏ô Central, The Mall">
      <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
      <input type="text" id="place_note" placeholder="‡πÑ‡∏õ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£">

      <label style="margin-top:10px">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£</label>
      <input type="text" id="food" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà, ‡∏ä‡∏≤‡∏ö‡∏π">

      <label style="margin-top:10px">‡πÇ‡∏ô‡πâ‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</label>
      <textarea id="notes" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏ô‡πâ‡∏ï‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î..."></textarea>

      <label style="margin-top:10px">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3)</label>
      <input type="file" id="photosInput" accept="image/*" multiple>
      <div class="photos" id="photosPreview"></div>

      <div class="actions">
        <button class="primary" onclick="saveToday()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="clearToday()">‡∏•‡πâ‡∏≤‡∏á</button>
      </div>
    </div>

    <!-- Timeline -->
    <div class="card" id="timeline">
      <h3 style="margin:0 0 10px 0;font-size:16px">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
      <div id="timelineList" style="display:grid;gap:8px"></div>
    </div>
  </div>

<script>
const WEEKDAYS = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];

function toWeekday(iso){
  const d = new Date(iso);
  return isNaN(d)? "‚Äî" : WEEKDAYS[d.getDay()];
}

function readDB(){
  try{
    const raw = localStorage.getItem('dj_db');
    return raw? JSON.parse(raw): {};
  } catch { return {}; }
}

function writeDB(db){
  localStorage.setItem('dj_db', JSON.stringify(db));
}

function loadToday(){
  const db = readDB();
  const date = document.getElementById('date').value;
  const entry = db[date] || {};
  document.getElementById('place').value = entry.place || '';
  document.getElementById('place_note').value = entry.place_note || '';
  document.getElementById('food').value = entry.food || '';
  document.getElementById('notes').value = entry.notes || '';
  renderPhotos(entry.photos || []);
}

function renderPhotos(arr){
  const preview = document.getElementById('photosPreview');
  preview.innerHTML = '';
  arr.forEach(src=>{
    const img=document.createElement('img');
    img.src=src;
    preview.appendChild(img);
  });
}

function resizeImage(file, maxSize=800){
  return new Promise(resolve=>{
    const reader = new FileReader();
    reader.onload = e=>{
      const img=new Image();
      img.onload=()=>{
        let w=img.width, h=img.height;
        if(w>h){ if(w>maxSize){ h*=maxSize/w; w=maxSize; } }
        else { if(h>maxSize){ w*=maxSize/h; h=maxSize; } }
        const canvas=document.createElement('canvas');
        canvas.width=w; canvas.height=h;
        canvas.getContext('2d').drawImage(img,0,0,w,h);
        resolve(canvas.toDataURL('image/jpeg',0.8));
      };
      img.src=e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

async function saveToday(){
  const db = readDB();
  const date = document.getElementById('date').value;
  const place = document.getElementById('place').value.trim();
  const place_note = document.getElementById('place_note').value.trim();
  const food = document.getElementById('food').value.trim();
  const notes = document.getElementById('notes').value.trim();

  let photos = [];
  const input = document.getElementById('photosInput');
  for(const f of Array.from(input.files).slice(0,3)){
    const base64 = await resizeImage(f);
    photos.push(base64);
  }
  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏õ‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
  if(photos.length===0 && db[date]) photos = db[date].photos || [];

  db[date] = { place, place_note, food, notes, photos };
  writeDB(db);
  loadToday();
  renderTimeline();
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
}

function clearToday(){
  document.getElementById('place').value='';
  document.getElementById('place_note').value='';
  document.getElementById('food').value='';
  document.getElementById('notes').value='';
  document.getElementById('photosInput').value='';
  document.getElementById('photosPreview').innerHTML='';
}

function renderTimeline(){
  const list=document.getElementById('timelineList');
  const db=readDB();
  const arr=Object.entries(db).map(([date,e])=>({date,...e}));
  arr.sort((a,b)=>b.date.localeCompare(a.date)); // ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô

  if(!arr.length){
    list.innerHTML=`<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>`;
    return;
  }
  list.innerHTML='';
  for(const it of arr){
    const card=document.createElement('div');
    card.style.cssText=`
      border:1px solid #1f2937;border-radius:12px;padding:10px;background:#0d1628;
      display:grid;gap:6px;`;

    const header=document.createElement('div');
    header.innerHTML=`<b>${it.date}</b> <span class="badge">${toWeekday(it.date)}</span>`;

    const line=document.createElement('div');
    line.className='muted';
    const parts=[];
    if(it.place) parts.push(`üìç ${it.place}`);
    if(it.place_note) parts.push(`üìù ${it.place_note}`);
    if(it.food) parts.push(`üçö ${it.food}`);
    line.textContent=parts.join('   ‚Ä¢   ');

    const notes=document.createElement('div');
    if(it.notes){ notes.textContent=it.notes; notes.style.whiteSpace='pre-wrap'; }

    const pics=document.createElement('div');
    pics.className='photos';
    (it.photos||[]).forEach(src=>{
      const img=document.createElement('img');
      img.src=src;
      pics.appendChild(img);
    });

    const actions=document.createElement('div');
    actions.className='actions';
    const viewBtn=document.createElement('button');
    viewBtn.textContent='‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π/‡πÅ‡∏Å‡πâ';
    viewBtn.onclick=()=>{
      document.getElementById('date').value=it.date;
      loadToday();
      window.scrollTo({top:0,behavior:'smooth'});
    };
    const delBtn=document.createElement('button');
    delBtn.textContent='‡∏•‡∏ö';
    delBtn.className='danger';
    delBtn.onclick=()=>{
      if(confirm(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${it.date}?`)){
        delete db[it.date];
        writeDB(db);
        renderTimeline();
      }
    };
    actions.appendChild(viewBtn);
    actions.appendChild(delBtn);

    card.appendChild(header);
    if(parts.length) card.appendChild(line);
    if(it.notes) card.appendChild(notes);
    if((it.photos||[]).length) card.appendChild(pics);
    card.appendChild(actions);

    list.appendChild(card);
  }
}

// init
document.addEventListener('DOMContentLoaded',()=>{
  const today=new Date().toISOString().split('T')[0];
  document.getElementById('date').value=today;
  loadToday();
  renderTimeline();
});
</script>
</body>
</html>
